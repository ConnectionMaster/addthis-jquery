<html>
    <head>
        <title>
            AddThis jQuery Plugin Example Code
        </title>
        <script src="../../node_modules/jquery/dist/jquery.js"></script>
        <script src="../../dist/jquery-addthis.js"></script>
        <!-- Go to www.addthis.com/dashboard to customize your tools -->
        <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-593dce7ba1919f85"></script>
        <link rel="stylesheet" href="../../node_modules/bootstrap/dist/css/bootstrap.css"></link>

        <style>
            body {
                padding: 30px 30px 30px 60px;
            }
            .catgif {
                padding: 10px;
                margin: 10px;
            }
        </style>
    </head>
    <body>
        <nav class="navbar navbar-light bg-faded">
            <a class="navbar-brand" href="#">jquery-addthis</a>

            <ul class="nav navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="./index.html">List of Tool Examples</a>
                </li>
            </ul>

            <ul class="nav navbar-nav float-xs-right">
                <li class="nav-item">
                    <a class="nav-link" href="https://www.addthis.com">AddThis</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="../docs/index.html">Documentation</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="./tests.html">Test Results</a>
                </li>
                <!--
                <li class="nav-item">
                    <a class="nav-link" href="#">GitHub</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">NPM</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">Bower</a>
                </li>
                -->
            </ul>

        </nav>

        <h1>
            AddThis jQuery Plugin Example Site
        </h1>
        <h2>
            Tool Example 10
            <small>
                adding image share buttons as images change
            </small>
        </h2>

        <p>Images via <a href="http://thecatapi.com/">The Cat Api</a></p>

        <div class="alert alert-info" role="alert">
            <span class="glyphicon glyphicon-info-sign" aria-hidden="true"></span>
            Share buttons will only appear on images that are at least 200px by 200px. The images used below are random. Some may not be big enough to have share buttons.
        </div>

        <div id='catGifContainer'>
        </div>

        <button type="button" class="btn btn-primary" id='addCat'>
            Change Image
        </button>

        <script>
            // initalizing array used for cat image queue
            var imageQueue = [];

            // function for changing the cat gif on the page
            function changeCat() {
                if (imageQueue.length === 0) {
                    // if we're out of cat images, get more, then recurse
                    getMoreImages(changeCat);
                } else {
                    // if we have more cat images
                    // pop next cat image url out of array
                    var url = imageQueue.pop();
                    // select the cat gif currently on the page
                    catGifImage = $('#catGifContainer img');
                    if (catGifImage.length === 0) {
                        // if we don't have one yet, add a cat image using
                        $('<img class="img-thumbnail catgif" alt="a random cat gif" src="' + url + '"></img>')
                            // append image element into the catGifContainer div
                            .appendTo('#catGifContainer');
                    } else {
                        // if we have one already, change the cat image by changing the src attribute
                        $(catGifImage[0]).attr('src', url);
                    }
                }
            }

            // function for retreiving more cat images from The Cat API
            // takes 1 parameter: a callback that is executed once the images are retrieved and proceesed into imageQueue
            function getMoreImages(callback) {
                // grab the XML from The Cat API
                $.ajax({
                    url: 'https://thecatapi.com/api/images/get',
                    data: {
                        format: 'xml',
                        results_per_page: '20',
                        type: 'gif',
                        size: 'med'
                    }
                }).done(function(data) {
                    // grab the url elements out of the XML document
                    var images = data.documentElement.getElementsByTagName('url');
                    // images is a psudo-array, not a real array. using slide to make it a real array.
                    images = Array.prototype.slice.call(images);
                    // loop through all the url elements
                    images.forEach(function(image) {
                        // grab the url string and put it in imageQueue
                        imageQueue.push(image.innerHTML);
                    });
                    // if a function was passed in the callback param, execute it now
                    if (typeof callback === 'function') {
                        callback();
                    }
                });
            }

            // bootstrap by adding first cat gif onto page
            changeCat();
            // call changeCat function whenever someone clicks on the button
            $('button#addCat').click(changeCat);
        </script>
    </body>
</html>